<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>batch-effects • llfsRnaseq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="batch-effects">
<meta property="og:description" content="llfsRnaseq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">llfsRnaseq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/llfsRnaseq.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">The RNAseq Database</li>
    <li>
      <a href="../articles/database-overview.html">Overview</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Processing Raw Data</li>
    <li>
      <a href="../articles/create-samplesheet.html">Creating A Samplesheet</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Initial QC</li>
    <li>
      <a href="../articles/sex-label-check.html">Sex Label Check</a>
    </li>
    <li>
      <a href="../articles/expression-qc.html">Expression QC</a>
    </li>
    <li>
      <a href="../articles/batch-effects.html">Batch Effects</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Creating a release</li>
    <li>
      <a href="../articles/creating-a-release.html">Setting filters and Exporting the Data</a>
    </li>
    <li>
      <a href="../articles/shared-data-overview.html">Shared Data Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://nf-co.re/rnaseq/3.3/" class="external-link">nf-core/rnaseq pipeline</a>
</li>
<li>
  <a href="https://github.com/cmatKhan/rnavar" class="external-link">modified nf-core/rnavar</a>
</li>
<li>
  <a href="https://longlifefamilystudy.wustl.edu" class="external-link"></a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>batch-effects</h1>
            
      
      
      <div class="hidden name"><code>batch-effects.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This is both batch effects, and also percent intergenic exploration.
This is (very clearly) part of my initial EDA that I have continued to
use. When the data was smaller – ie, when we only had a couple hundred
samples – this was fine. As the data has grown, this has become unweidly
and it is in need of refactoring. I typically run this on the HTCF
cluster with 4 cpus and 60 GB.</p>
<p>Unlike the <a href="articles/sex-label-check.html">Sex Mislabelling
QC</a> and <a href="articles/expression-qc.html">Expression QC</a>, in
this there aren’t any steps that necessarily require updating the
database for new samples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikelove/DESeq2" class="external-link">DESeq2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioinf.wehi.edu.au/edgeR/" class="external-link">edgeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nanx.me/ggsci/" class="external-link">ggsci</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org" class="external-link">RSQLite</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmatkhan.github.io/llfsRnaseq/" class="external-link">llfsRnaseq</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  cache<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>  include<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>  echo<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>  dpi<span class="op">=</span><span class="fl">200</span>,</span>
<span>  fig.width <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  fig.height <span class="op">=</span> <span class="fl">8</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set ggplot global options</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_update</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>             panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                                         fill <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                                         size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DDS_RDS_PATH</span> <span class="op">=</span> <span class="st">"llfs_rnaseq_data/dds_20230227_gene.rds"</span></span>
<span></span>
<span><span class="va">GENOME_ANNOT_TXDB_PATH</span> <span class="op">=</span> <span class="st">"llfs_rnaseq_data/gencode38_gtf_parsed_as_df_20210919.sqlite"</span></span>
<span></span>
<span><span class="co"># remove data objects which are not used after a given chunk</span></span>
<span><span class="va">CLEAN_UP</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">34</span></span>
<span><span class="va">qual_col_pals</span> <span class="op">=</span> <span class="va">brewer.pal.info</span><span class="op">[</span><span class="va">brewer.pal.info</span><span class="op">$</span><span class="va">category</span> <span class="op">==</span> <span class="st">'qual'</span>,<span class="op">]</span></span>
<span><span class="va">PLATE_COLORS</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">brewer.pal</span>, <span class="va">qual_col_pals</span><span class="op">$</span><span class="va">maxcolors</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">qual_col_pals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PLATE_COLORS</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html" class="external-link">MulticoreParam</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">GENE_DDS_PATH</span> <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"llfs_rnaseq_data/dds_20230713_gene.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="deduplicate-by-percent_intergenic">Deduplicate by percent_intergenic<a class="anchor" aria-label="anchor" href="#deduplicate-by-percent_intergenic"></a>
</h2>
<p>There are duplicate (subject,visit) samples which result from both
on-purpose re-do samples, and also re-labelling of mislabeled samples.
Regardless of why, in this step we deduplicate by grouping by
(subject,visit) and then selecting only the sample with the minimum
percent_intergenic. Note that if there is a group of 1 (meaning, no
duplicates), then that sample is always selected.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">GENE_DDS_PATH</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ensure that batch_id and sex are factored</span></span>
<span><span class="va">dds</span><span class="op">$</span><span class="va">batch_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dds</span><span class="op">$</span><span class="va">batch_id</span><span class="op">)</span></span>
<span><span class="va">dds</span><span class="op">$</span><span class="va">sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dds</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata</span> <span class="op">=</span> <span class="va">dds</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dds_control</span> <span class="op">=</span> <span class="va">dds</span><span class="op">[</span>, <span class="va">dds</span><span class="op">$</span><span class="va">sex</span><span class="op">==</span><span class="st">'control'</span> <span class="op">|</span><span class="op">(</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dds</span><span class="op">$</span><span class="va">relabel_reason</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">dds</span><span class="op">$</span><span class="va">relabel_reason</span> <span class="op">==</span> <span class="st">'phantom'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dds_control</span><span class="op">$</span><span class="va">purpose</span> <span class="op">=</span> <span class="st">'control'</span></span>
<span></span>
<span><span class="va">dds_experiment</span> <span class="op">=</span> <span class="va">dds</span><span class="op">[</span>,<span class="op">!</span><span class="va">dds</span><span class="op">$</span><span class="va">sample_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dds_control</span><span class="op">$</span><span class="va">sample_id</span><span class="op">]</span></span>
<span><span class="va">dds_experiment</span><span class="op">$</span><span class="va">purpose</span> <span class="op">=</span> <span class="st">'experiment'</span></span>
<span></span>
<span><span class="va">dedup_df</span> <span class="op">=</span> <span class="va">dds_experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject</span>,<span class="va">visit</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">percent_intergenic</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">percent_intergenic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dedup_dds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dds_control</span>, <span class="va">dds_experiment</span><span class="op">[</span>,<span class="va">dds_experiment</span><span class="op">$</span><span class="va">sample_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dedup_df</span><span class="op">$</span><span class="va">sample_id</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-the-initial-qc-data">Generate the initial QC data<a class="anchor" aria-label="anchor" href="#generate-the-initial-qc-data"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qc_datasets</span> <span class="op">=</span> <span class="fu"><a href="../reference/batch_effect_qc_setup.html">batch_effect_qc_setup</a></span><span class="op">(</span><span class="va">dedup_dds</span>, <span class="fl">.015</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pca-plots-looking-for-batch-effects-outliers-etc">PCA plots – looking for batch effects, outliers, etc…<a class="anchor" aria-label="anchor" href="#pca-plots-looking-for-batch-effects-outliers-etc"></a>
</h2>
<div class="section level3">
<h3 id="all-samples">all samples<a class="anchor" aria-label="anchor" href="#all-samples"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span><span class="op">$</span><span class="va">all</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>batch_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">batch_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">batch_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">PLATE_COLORS</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="passing-samples-post-expression-filter">Passing samples, post expression filter<a class="anchor" aria-label="anchor" href="#passing-samples-post-expression-filter"></a>
</h3>
<p>No genes are excluded from the PC calculate (ie unlike the sex
mislabel PCA plots, which were done on the top 500 most variable
genes)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span><span class="op">$</span><span class="va">passing</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>batch_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">batch_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, color <span class="op">=</span> <span class="va">batch_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">PLATE_COLORS</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#ggsave(here(sprintf("plots/pca_all_%s.png", as.character(format(Sys.time(), "%Y%m%d")))), bg="white")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="all-samples-all-genes-post-expression-filter">all samples, all genes (post expression filter)<a class="anchor" aria-label="anchor" href="#all-samples-all-genes-post-expression-filter"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir_change_by_percent_intergenic_plt</span> <span class="op">=</span> <span class="fu"><a href="../reference/direction_change_in_percent_intergenic.html">direction_change_in_percent_intergenic</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span>, </span>
<span>                                                <span class="va">PLATE_COLORS</span>, </span>
<span>                                                slope_dir <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">dir_change_by_percent_intergenic_plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">250</span>,<span class="fl">100</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>,<span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="try-to-remove-percent-intergenic-effect">try to remove percent intergenic effect<a class="anchor" aria-label="anchor" href="#try-to-remove-percent-intergenic-effect"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dds_intergenic_only_design</span> <span class="op">=</span> <span class="fu"><a href="../reference/filter_dds_restimate_sizeFactors.html">filter_dds_restimate_sizeFactors</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span>, </span>
<span>                                                gene_fltr <span class="op">=</span> <span class="va">qc_datasets</span><span class="op">$</span><span class="va">expr_fltr</span>, </span>
<span>                                                qc_sample_fltr <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">design</span><span class="op">(</span><span class="va">dds_intergenic_only_design</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="op">~</span><span class="va">percent_intergenic</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dds_intergenic_only_design</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeq.html" class="external-link">DESeq</a></span><span class="op">(</span><span class="va">dds_intergenic_only_design</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">percent_intergenic_effect_removed</span> <span class="op">=</span> <span class="fu"><a href="../reference/remove_parameter_effects.html">remove_parameter_effects</a></span><span class="op">(</span><span class="va">dds_intergenic_only_design</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">intergenic_only_design_projection</span> <span class="op">=</span> <span class="fu"><a href="../reference/project_counts_onto_orig_pcs.html">project_counts_onto_orig_pcs</a></span><span class="op">(</span><span class="va">dds_intergenic_only_design</span>, <span class="va">percent_intergenic_effect_removed</span><span class="op">)</span></span>
<span></span>
<span><span class="va">after_intergenic_effect_removed</span> <span class="op">=</span> <span class="va">intergenic_only_design_projection</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'PC1'</span>,<span class="st">'PC2'</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames<span class="op">=</span><span class="st">'count_headers'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">dds_intergenic_only_design</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">only_passing_lm_percent_intergenic_effect_removed</span> <span class="op">=</span> </span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">percent_intergenic</span><span class="op">~</span><span class="va">PC1</span><span class="op">+</span><span class="va">PC2</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">after_intergenic_effect_removed</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">delta_y</span> <span class="op">=</span> <span class="va">only_passing_lm_percent_intergenic_effect_removed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"PC2"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">delta_x</span> <span class="op">=</span> <span class="va">only_passing_lm_percent_intergenic_effect_removed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"PC1"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">sample_status</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">purpose</span> <span class="op">==</span> <span class="st">"control"</span>, </span>
<span>         <span class="st">"control"</span>, </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">sample_status</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">sample_status</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">sample_status</span> <span class="op">==</span> <span class="st">"control"</span>,</span>
<span>         <span class="st">"control"</span>,</span>
<span>         <span class="va">qc_datasets</span><span class="op">$</span><span class="va">pca_df_list</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">sample_status</span><span class="op">)</span></span>
<span></span>
<span><span class="va">after_intergenic_effect_removed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y<span class="op">=</span><span class="va">PC2</span>, color<span class="op">=</span><span class="va">sample_status</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span><span class="fl">.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt;= 8 % intergenic"</span>, </span>
<span>                                <span class="st">"&lt; 8 % intergenic"</span>,</span>
<span>                                <span class="st">"control"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span>,</span>
<span>                                <span class="st">"control"</span> <span class="op">=</span> <span class="st">"#F4A000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">250</span>,<span class="fl">100</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>,<span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="va">delta_y</span><span class="op">/</span><span class="va">delta_x</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="linear-modelling">linear modelling<a class="anchor" aria-label="anchor" href="#linear-modelling"></a>
</h2>
<div class="section level3">
<h3 id="linear-regression-predictors-plates-response-pc1---10">linear regression, predictors: plates, response: PC1 - 10<a class="anchor" aria-label="anchor" href="#linear-regression-predictors-plates-response-pc1---10"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">passing_logNorm_counts</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/normTransform.html" class="external-link">normTransform</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span><span class="op">[</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">expr_fltr</span>,</span>
<span>                                       <span class="va">qc_datasets</span><span class="op">$</span><span class="va">sample_fltr</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">pca_passing_logNorm_counts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">passing_logNorm_counts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plate_predicts_pcs_with_plate_effect</span> <span class="op">=</span> <span class="fu"><a href="../reference/before_after_pca_and_plate_regression_plots.html">before_after_pca_and_plate_regression_plots</a></span><span class="op">(</span></span>
<span>  <span class="va">passing_logNorm_counts</span>,</span>
<span>  <span class="va">pca_passing_logNorm_counts</span>,</span>
<span>  <span class="st">'PC6'</span>,</span>
<span>  <span class="st">'PC10'</span>,</span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span><span class="op">[</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">expr_fltr</span>, <span class="va">qc_datasets</span><span class="op">$</span><span class="va">sample_fltr</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">PLATE_COLORS</span>,</span>
<span>  <span class="st">"with plate effect"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="variance-explained">variance explained<a class="anchor" aria-label="anchor" href="#variance-explained"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate_predicts_pcs_with_plate_effect</span><span class="op">$</span><span class="va">pc_pred_plate</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.7</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="rsquared">rsquared<a class="anchor" aria-label="anchor" href="#rsquared"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate_predicts_pcs_with_plate_effect</span><span class="op">$</span><span class="va">pcaplot</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">expr_fltr_passing_samples</span> <span class="op">=</span> <span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span><span class="op">[</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">expr_fltr</span>, <span class="va">qc_datasets</span><span class="op">$</span><span class="va">sample_fltr</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">design</span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="op">~</span><span class="va">batch_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">expr_fltr_passing_samples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/DESeq.html" class="external-link">DESeq</a></span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span>, parallel<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span><span class="op">)</span> <span class="op">=</span> <span class="va">expr_fltr_passing_samples</span><span class="op">$</span><span class="va">count_headers</span></span>
<span></span>
<span><span class="va">plate_effect_effect_removed</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="../reference/remove_parameter_effects.html">remove_parameter_effects</a></span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">34</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plate_effect_removed_projection</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="../reference/project_counts_onto_orig_pcs.html">project_counts_onto_orig_pcs</a></span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span>, </span>
<span>                               <span class="va">plate_effect_effect_removed</span><span class="op">)</span></span>
<span></span>
<span><span class="va">removed_effect_y_df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">plate_effect_removed_projection</span>, </span>
<span>                                rownames <span class="op">=</span> <span class="st">'sample'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sample_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">sample</span>, <span class="st">"sample_"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="linear-regression-predictors-plates-response-pc1---10-1">linear regression, predictors: plates, response: PC1 - 10<a class="anchor" aria-label="anchor" href="#linear-regression-predictors-plates-response-pc1---10-1"></a>
</h3>
<p>Interestingly, the difference between the variance explained by the
vst, and the variance explained by log2 norm counts is very different.
The variance explained on the vst data is greater than that of the log
norm.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/normTransform.html" class="external-link">normTransform</a></span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">effect_removed_pca</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">plate_effect_effect_removed</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">percentVar_effect_removed</span> <span class="op">&lt;-</span> <span class="va">effect_removed_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="va">effect_removed_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">percentVar_passing_samples</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="va">test</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">percent_var_df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  data_state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"prior"</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"post"</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prior"</span>, <span class="st">"post"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  PC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  variance_by_pc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">percentVar_passing_samples</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="va">percentVar_effect_removed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">percent_var_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">PC</span>, <span class="va">variance_by_pc</span>, fill <span class="op">=</span> <span class="va">data_state</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prior"</span><span class="op">=</span><span class="st">"#9E9AC8FF"</span>,</span>
<span>                               <span class="st">"post"</span> <span class="op">=</span> <span class="st">"#FD8D3CFF"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lm-plot">lm plot<a class="anchor" aria-label="anchor" href="#lm-plot"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate_predicts_pcs_removed_plate_effect</span> <span class="op">=</span> <span class="fu"><a href="../reference/before_after_pca_and_plate_regression_plots.html">before_after_pca_and_plate_regression_plots</a></span><span class="op">(</span></span>
<span>  <span class="va">plate_effect_effect_removed</span>,</span>
<span>  <span class="va">pca_passing_logNorm_counts</span>,</span>
<span>  <span class="st">'PC6'</span>,</span>
<span>  <span class="st">'PC10'</span>,</span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span><span class="op">[</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">expr_fltr</span>, <span class="va">qc_datasets</span><span class="op">$</span><span class="va">sample_fltr</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">PLATE_COLORS</span>,</span>
<span>  <span class="st">"with plate effect"</span>,</span>
<span>  <span class="va">plate_predicts_pcs_with_plate_effect</span><span class="op">$</span><span class="va">pc_levels</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate_predicts_pcs_with_plate_effect</span><span class="op">$</span><span class="va">pcaplot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"plots/with_effect_pca_%s.png"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       device <span class="op">=</span> <span class="st">'png'</span>,</span>
<span>       bg <span class="op">=</span> <span class="st">'white'</span>,</span>
<span>       width <span class="op">=</span> <span class="fl">14</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate_predicts_pcs_removed_plate_effect</span><span class="op">$</span><span class="va">pcaplot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"plots/effect_removed_pca_%s.png"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       device <span class="op">=</span> <span class="st">'png'</span>,</span>
<span>       bg <span class="op">=</span> <span class="st">'white'</span>,</span>
<span>       width <span class="op">=</span> <span class="fl">14</span>, height <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate_predicts_pcs_with_plate_effect</span><span class="op">$</span><span class="va">pc_pred_plate</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.7</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"plots/plate_predicts_pcs_with_effect_%s.png"</span> , <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            device <span class="op">=</span> <span class="st">'png'</span>, </span>
<span>            bg <span class="op">=</span> <span class="st">'white'</span>, </span>
<span>            width <span class="op">=</span> <span class="fl">14</span>, </span>
<span>            height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>       dpi <span class="op">=</span> <span class="st">'print'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plate_predicts_pcs_removed_plate_effect</span><span class="op">$</span><span class="va">pc_pred_plate</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.7</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.7</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"plots/plate_predicts_pcs_removed_effect_%s.png"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            device <span class="op">=</span> <span class="st">'png'</span>, </span>
<span>            bg <span class="op">=</span> <span class="st">'white'</span>, </span>
<span>            width <span class="op">=</span> <span class="fl">14</span>, </span>
<span>            height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>       dpi <span class="op">=</span> <span class="st">'print'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">scaled_log2_norm_passing_prcomp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assays</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/normTransform.html" class="external-link">normTransform</a></span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">percentVar_passing_samples</span> <span class="op">&lt;-</span> <span class="va">effect_removed_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span> <span class="va">effect_removed_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">percent_var_df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  PC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2'</span>,<span class="st">'4'</span>,<span class="st">'8'</span>,<span class="st">'1'</span>,<span class="st">'7'</span>,<span class="st">'9'</span>,<span class="st">'3'</span>,<span class="st">'5'</span>,<span class="st">'10'</span>,<span class="st">'6'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  variance_by_pc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">percentVar_passing_samples</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">scree_expr_passing_plate_removed</span> <span class="op">=</span> <span class="va">percent_var_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">PC</span>, <span class="va">variance_by_pc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># ggtitle("Scree plot: before removing plate effect") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_update</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>        panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'black'</span>, fill <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scree_expr_passing_plate_removed</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note: check to make sure the pc orders are correct -- the labels </span></span>
<span><span class="co"># are removed here, so easy to make mistake</span></span>
<span><span class="va">plt1</span> <span class="op">=</span> <span class="va">plate_predicts_pcs_with_plate_effect</span><span class="op">$</span><span class="va">pc_pred_plate</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.7</span>, by <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt2</span> <span class="op">=</span> <span class="va">scree_expr_passing_plate_removed</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt3</span> <span class="op">=</span> <span class="va">plate_predicts_pcs_with_plate_effect</span><span class="op">$</span><span class="va">pcaplot</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">before_regress_out_plate_ptchwork</span> <span class="op">=</span> </span>
<span>  <span class="op">(</span><span class="op">(</span><span class="va">plt1</span> <span class="op">/</span> <span class="va">plt2</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">plt3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu">plot_annotation</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">'Before Regressing Out Plate Effect'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"plots/before_regress_out_plate_ptchwork_%s.png"</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="va">before_regress_out_plate_ptchwork</span>, bg<span class="op">=</span><span class="st">"white"</span>, width<span class="op">=</span><span class="fl">15</span>, height<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">before_regress_out_plate_ptchwork</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note: dims are 2490, 900 for after. try to make it the same for this one</span></span>
<span></span>
<span><span class="co"># note: check to make sure the pc orders are correct -- the labels </span></span>
<span><span class="co"># are removed here, so easy to make mistake</span></span>
<span><span class="va">plt1</span> <span class="op">=</span> <span class="va">plate_predicts_pcs_removed_plate_effect</span><span class="op">$</span><span class="va">pc_pred_plate</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.7</span>, by <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>        axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt2</span> <span class="op">=</span> <span class="va">scree_expr_passing_plate_removed</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt3</span> <span class="op">=</span> <span class="va">plate_predicts_pcs_removed_plate_effect</span><span class="op">$</span><span class="va">pcaplot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">after_regress_out_plate_ptchwork</span> <span class="op">=</span> </span>
<span>  <span class="op">(</span><span class="op">(</span><span class="va">plt1</span> <span class="op">/</span> <span class="va">plt2</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">plt3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu">plot_annotation</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">'After Regressing Out Plate Effect'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"plots/after_regress_out_plate_ptchwork_%s.png"</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="va">after_regress_out_plate_ptchwork</span>, bg<span class="op">=</span><span class="st">"white"</span>, width<span class="op">=</span><span class="fl">15</span>, height<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">after_regress_out_plate_ptchwork</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># knitr::kable(broom::tidy(logistic_pcs_to_plate) %&gt;%</span></span>
<span><span class="co">#                arrange(p.value), format = "simple")</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="misc">Misc<a class="anchor" aria-label="anchor" href="#misc"></a>
</h2>
<p>I am leaving the code below this point in the vignette, but I don’t
typically use it or look at it. It is left here ‘just in case’.</p>
<div class="section level3">
<h3 id="pc3-vs-pc10">PC3 vs PC10<a class="anchor" aria-label="anchor" href="#pc3-vs-pc10"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">lm_data_removed_effect</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC5</span>, y<span class="op">=</span><span class="va">PC8</span>, color<span class="op">=</span><span class="va">plate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">.5</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html" class="external-link">stat_ellipse</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="va">plate</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># scale_linetype_manual(values = c(0,1,1,0,0,0,0,0,0,0,0)) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">PLATE_COLORS</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">75</span>,<span class="fl">75</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pc7-vs-pc10">PC7 vs PC10<a class="anchor" aria-label="anchor" href="#pc7-vs-pc10"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">lm_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC10</span>, y<span class="op">=</span><span class="va">PC7</span>, color<span class="op">=</span><span class="va">plate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">.5</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html" class="external-link">stat_ellipse</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="va">plate</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"3"</span> <span class="op">=</span> <span class="st">"#E64B35FF"</span>,</span>
<span>                                <span class="st">"4"</span><span class="op">=</span><span class="st">"#4DBBD5FF"</span>,</span>
<span>                                <span class="st">"5"</span><span class="op">=</span><span class="st">"#00A087FF"</span>,</span>
<span>                                <span class="st">"6"</span><span class="op">=</span><span class="st">"#3C5488FF"</span>,</span>
<span>                                <span class="st">"7"</span><span class="op">=</span><span class="st">"#F39B7FFF"</span>,</span>
<span>                                <span class="st">"8"</span><span class="op">=</span><span class="st">"#8491B4FF"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">40</span>, <span class="fl">40</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## density plot</span></span>
<span></span>
<span><span class="co"># # transparentTheme(trans = .9)</span></span>
<span><span class="co"># featurePlot(x = log2_norm_passing_prcomp_df[, 3:12],</span></span>
<span><span class="co">#             y = log2_norm_passing_prcomp_df$plate,</span></span>
<span><span class="co">#             plot = "density", </span></span>
<span><span class="co">#             ## Pass in options to xyplot() to </span></span>
<span><span class="co">#             ## make it prettier</span></span>
<span><span class="co">#             scales = list(x = list(relation="free"), </span></span>
<span><span class="co">#                           y = list(relation="free")), </span></span>
<span><span class="co">#             # adjust = 1.5, </span></span>
<span><span class="co">#             auto.key = list(columns = 3))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="boxplot-pc1-to-10-by-plate">boxplot, PC1 to 10, by plate<a class="anchor" aria-label="anchor" href="#boxplot-pc1-to-10-by-plate"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## boxplot, PC1 to 10, by plate</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/featurePlot.html" class="external-link">featurePlot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">log2_norm_passing_prcomp_df</span><span class="op">[</span>, <span class="fl">6</span>,<span class="fl">10</span>,<span class="fl">12</span><span class="op">]</span>,</span>
<span>            y <span class="op">=</span> <span class="va">log2_norm_passing_prcomp_df</span><span class="op">$</span><span class="va">plate</span>,</span>
<span>            plot <span class="op">=</span> <span class="st">"box"</span>,</span>
<span>            <span class="co"># scales = list(y = list(relation="free"),</span></span>
<span>            <span class="co">#               x = list(rot = 90)),</span></span>
<span>            scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>            <span class="co">## Add a key at the top</span></span>
<span>            auto.key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="qc-distributions">QC distributions<a class="anchor" aria-label="anchor" href="#qc-distributions"></a>
</h2>
<div class="section level3">
<h3 id="percent_intergenic-distribution-by-plate">percent_intergenic distribution by plate<a class="anchor" aria-label="anchor" href="#percent_intergenic-distribution-by-plate"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sample_status <span class="op">=</span> </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">purpose</span> <span class="op">==</span> <span class="st">"control"</span>, <span class="st">"control"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sample_status</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">percent_intergenic_vs_plate</span> <span class="op">=</span> <span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">plate</span>,y<span class="op">=</span><span class="va">percent_intergenic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.8</span>,size <span class="op">=</span> <span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">sample_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt;= 8 % intergenic"</span>, </span>
<span>                                <span class="st">"&lt; 8 % intergenic"</span>,</span>
<span>                                <span class="st">"control"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span>,</span>
<span>                                <span class="st">"control"</span> <span class="op">=</span> <span class="st">"#F4A000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">percent_intergenic_slide_plts</span> <span class="op">=</span> <span class="va">percent_intergenic_vs_plate</span> <span class="op">+</span> <span class="va">dir_change_by_percent_intergenic_plt</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">'plots/percent_integenic_vs_plate_and_by_pc_%s.png'</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="va">percent_intergenic_slide_plts</span>, </span>
<span>       device <span class="op">=</span> <span class="st">'png'</span>, width <span class="op">=</span> <span class="fl">30</span>, height <span class="op">=</span> <span class="fl">8</span>, bg <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="percent_exonic-vs-percent_intergenic">percent_exonic vs percent_intergenic<a class="anchor" aria-label="anchor" href="#percent_exonic-vs-percent_intergenic"></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">percent_exonic</span>,x<span class="op">=</span><span class="va">percent_intergenic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.8</span>,size <span class="op">=</span> <span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">sample_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt;= 8 % intergenic"</span>, </span>
<span>                                <span class="st">"&lt; 8 % intergenic"</span>,</span>
<span>                                <span class="st">"control"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span>,</span>
<span>                                <span class="st">"control"</span> <span class="op">=</span> <span class="st">"#F4A000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">percent_intergenic</span>,y<span class="op">=</span><span class="va">QualiMap_mqc_generalstats_qualimap_5_3_bias</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.8</span>,size <span class="op">=</span> <span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">sample_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt;= 8 % intergenic"</span>, </span>
<span>                                <span class="st">"&lt; 8 % intergenic"</span>,</span>
<span>                                <span class="st">"control"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span>,</span>
<span>                                <span class="st">"control"</span> <span class="op">=</span> <span class="st">"#F4A000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">percent_intergenic</span>,y<span class="op">=</span><span class="va">insert_size_average</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.8</span>,size <span class="op">=</span> <span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">sample_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt;= 8 % intergenic"</span>, </span>
<span>                                <span class="st">"&lt; 8 % intergenic"</span>,</span>
<span>                                <span class="st">"control"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span>,</span>
<span>                                <span class="st">"control"</span> <span class="op">=</span> <span class="st">"#F4A000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">percent_intergenic</span>,y<span class="op">=</span><span class="va">novel_splicing_events_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.8</span>,size <span class="op">=</span> <span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">sample_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt;= 8 % intergenic"</span>, </span>
<span>                                <span class="st">"&lt; 8 % intergenic"</span>,</span>
<span>                                <span class="st">"control"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span>,</span>
<span>                                <span class="st">"control"</span> <span class="op">=</span> <span class="st">"#F4A000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="percent_exonic-vs-percent_intronic">percent_exonic vs percent_intronic<a class="anchor" aria-label="anchor" href="#percent_exonic-vs-percent_intronic"></a>
</h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">percent_exonic</span>,y<span class="op">=</span><span class="va">percent_intronic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.8</span>,size <span class="op">=</span> <span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">sample_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt;= 8 % intergenic"</span>, </span>
<span>                                <span class="st">"&lt; 8 % intergenic"</span>,</span>
<span>                                <span class="st">"control"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span>,</span>
<span>                                <span class="st">"control"</span> <span class="op">=</span> <span class="st">"#F4A000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="percent_intronic-vs-percent_intergenic">percent_intronic vs percent_intergenic<a class="anchor" aria-label="anchor" href="#percent_intronic-vs-percent_intergenic"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">percent_intronic</span>,x<span class="op">=</span><span class="va">percent_intergenic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.8</span>,size <span class="op">=</span> <span class="fl">3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">sample_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&gt;= 8 % intergenic"</span>, </span>
<span>                                <span class="st">"&lt; 8 % intergenic"</span>,</span>
<span>                                <span class="st">"control"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc_fail"</span> <span class="op">=</span> <span class="st">"#DB4325"</span>,</span>
<span>                                <span class="st">"qc_pass"</span><span class="op">=</span><span class="st">"#006164"</span>,</span>
<span>                                <span class="st">"control"</span> <span class="op">=</span> <span class="st">"#F4A000"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="counts-and-count-filtering">counts and count filtering<a class="anchor" aria-label="anchor" href="#counts-and-count-filtering"></a>
</h2>
<p>First set are the distribution of log2 counts. Next set are sparsity
plots (from deseq)</p>
<p>Sparsity Plot Description (From DESeq)</p>
<p>A simple plot of the concentration of counts in a single sample over
the sum of counts per gene. Not technically the same as “sparsity”, but
this plot is useful diagnostic for datasets which might not fit a
negative binomial assumption: genes with many zeros and individual very
large counts are difficult to model with the negative binomial
distribution.</p>
<div class="section level3">
<h3 id="distribution-of-counts-all-samples-no-filter">distribution of counts – all samples, no filter<a class="anchor" aria-label="anchor" href="#distribution-of-counts-all-samples-no-filter"></a>
</h3>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html" class="external-link">cpm</a></span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span><span class="op">)</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>          rownames <span class="op">=</span> <span class="st">"gene_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">gene_id</span>, names_to <span class="op">=</span> <span class="st">"sample"</span>, values_to <span class="op">=</span>  <span class="st">"log2cpm"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log2cpm</span>, color<span class="op">=</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expression-filter">expression filter<a class="anchor" aria-label="anchor" href="#expression-filter"></a>
</h3>
</div>
<div class="section level3">
<h3 id="gene-data">gene data<a class="anchor" aria-label="anchor" href="#gene-data"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tally_sql</span> <span class="op">=</span> <span class="st">"SELECT gene_type, COUNT(DISTINCT gene_id)</span></span>
<span><span class="st">FROM gencode38</span></span>
<span><span class="st">WHERE gene_type IN ('protein_coding', 'lncRNA')</span></span>
<span><span class="st">GROUP BY gene_type</span></span>
<span><span class="st">ORDER BY COUNT(gene_type) DESC;"</span></span>
<span></span>
<span><span class="va">gene_type_tally</span> <span class="op">=</span> <span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">gencode_38_db</span>, <span class="va">tally_sql</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">gene_type_tally</span>, format <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filtr-genes">filtr genes<a class="anchor" aria-label="anchor" href="#filtr-genes"></a>
</h3>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># AND gene_type IN ('protein_coding', 'lncRNA')</span></span>
<span><span class="va">tally_sql</span> <span class="op">=</span></span>
<span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue_sql.html" class="external-link">glue_sql</a></span><span class="op">(</span><span class="st">"SELECT gene_type, COUNT(DISTINCT gene_id)</span></span>
<span><span class="st">FROM gencode38</span></span>
<span><span class="st">WHERE gene_id IN ({gene_id_list*}) AND gene_type IN ('protein_coding', 'lncRNA')</span></span>
<span><span class="st">GROUP BY gene_type</span></span>
<span><span class="st">ORDER BY COUNT(gene_type) DESC"</span>,</span>
<span>gene_id_list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dds_list</span><span class="op">$</span><span class="va">expr</span><span class="op">)</span>,</span>
<span>.con <span class="op">=</span> <span class="va">gencode_38_db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gene_type_tally</span> <span class="op">=</span> <span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">gencode_38_db</span>, <span class="va">tally_sql</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">gene_type_tally</span>, format <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fltr-and-qc-fltr-genes">fltr and qc fltr genes<a class="anchor" aria-label="anchor" href="#fltr-and-qc-fltr-genes"></a>
</h3>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tally_sql</span> <span class="op">=</span></span>
<span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue_sql.html" class="external-link">glue_sql</a></span><span class="op">(</span><span class="st">"SELECT DISTINCT gene_type, COUNT(DISTINCT gene_id)</span></span>
<span><span class="st">FROM gencode38</span></span>
<span><span class="st">WHERE gene_id IN ({gene_id_list*}) AND gene_type IN ('protein_coding', 'lncRNA')</span></span>
<span><span class="st">GROUP BY gene_type</span></span>
<span><span class="st">ORDER BY COUNT(gene_type) DESC"</span>,</span>
<span>gene_id_list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dds_list</span><span class="op">$</span><span class="va">expr_passing</span><span class="op">)</span>,</span>
<span>.con <span class="op">=</span> <span class="va">gencode_38_db</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gene_type_tally</span> <span class="op">=</span> <span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">gencode_38_db</span>, <span class="va">tally_sql</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">gene_type_tally</span>, format <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="gene-expr-filter">gene expr filter<a class="anchor" aria-label="anchor" href="#gene-expr-filter"></a>
</h3>
<p>More than 3 counts per million in 4 of more (of 563) samples</p>
<p>Number of genes: 19824 out of 60649. Total coding genes in gencode38
~21k</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html" class="external-link">cpm</a></span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="fu"><a href="../reference/filter_dds_restimate_sizeFactors.html">filter_dds_restimate_sizeFactors</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span>, </span>
<span>                                                    gene_fltr <span class="op">=</span> <span class="va">qc_datasets</span><span class="op">$</span><span class="va">expr_fltr</span><span class="op">)</span><span class="op">)</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>          rownames <span class="op">=</span> <span class="st">"gene_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">gene_id</span>, names_to <span class="op">=</span> <span class="st">"sample"</span>, values_to <span class="op">=</span>  <span class="st">"log2cpm"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">qc_datasets</span><span class="op">$</span><span class="va">dds</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sample"</span> <span class="op">=</span> <span class="st">"subject_count_headers"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># filter(plate %in% c(3,4,5,6,7,8)) %&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log2cpm</span>, color<span class="op">=</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="expression-filter-and-qc-filter">expression filter and QC filter<a class="anchor" aria-label="anchor" href="#expression-filter-and-qc-filter"></a>
</h3>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html" class="external-link">cpm</a></span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">expr_fltr_passing_samples</span><span class="op">)</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>          rownames <span class="op">=</span> <span class="st">"gene_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">gene_id</span>, names_to <span class="op">=</span> <span class="st">"sample"</span>, values_to <span class="op">=</span>  <span class="st">"log2cpm"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">log2cpm</span>, color<span class="op">=</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sparsity-all-samples-no-filters">Sparsity: all samples, no filters<a class="anchor" aria-label="anchor" href="#sparsity-all-samples-no-filters"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/plotSparsity.html" class="external-link">plotSparsity</a></span><span class="op">(</span><span class="va">dds_list</span><span class="op">$</span><span class="va">raw</span>, normalized<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sparsity-all-samples-expression-filter">Sparsity: all samples, expression filter<a class="anchor" aria-label="anchor" href="#sparsity-all-samples-expression-filter"></a>
</h3>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/plotSparsity.html" class="external-link">plotSparsity</a></span><span class="op">(</span><span class="va">dds_list</span><span class="op">$</span><span class="va">expr</span>, normalized<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sparsity-all-samples-expression-filter-qc-filter">Sparsity: all samples, expression filter + QC filter<a class="anchor" aria-label="anchor" href="#sparsity-all-samples-expression-filter-qc-filter"></a>
</h3>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/DESeq2/man/plotSparsity.html" class="external-link">plotSparsity</a></span><span class="op">(</span><span class="va">dds_list</span><span class="op">$</span><span class="va">expr_passing</span>, normalized<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">gencode_38_db</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">today</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span></span>
<span><span class="co"># write_rds(dds, paste0("../share_llfs_llfs_rnaseq_data/llfs_rnaseq_data/dds_0312_to_1011_", paste0(today, ".rds")))</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Chase Mateusiak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
