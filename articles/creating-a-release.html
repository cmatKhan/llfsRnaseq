<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>creating-a-release • llfsRnaseq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="creating-a-release">
<meta property="og:description" content="llfsRnaseq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">llfsRnaseq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/llfsRnaseq.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">The RNAseq Database</li>
    <li>
      <a href="../articles/database-overview.html">Overview</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Processing Raw Data</li>
    <li>
      <a href="../articles/create-samplesheet.html">Creating A Samplesheet</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Initial QC</li>
    <li>
      <a href="../articles/sex-label-check.html">Sex Label Check</a>
    </li>
    <li>
      <a href="../articles/expression-qc.html">Expression QC</a>
    </li>
    <li>
      <a href="../articles/batch-effects.html">Batch Effects</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Creating a release</li>
    <li>
      <a href="../articles/creating-a-release.html">Setting filters and Exporting the Data</a>
    </li>
    <li>
      <a href="../articles/shared-data-overview.html">Shared Data Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://nf-co.re/rnaseq/3.3/" class="external-link">nf-core/rnaseq pipeline</a>
</li>
<li>
  <a href="https://github.com/cmatKhan/rnavar" class="external-link">modified nf-core/rnavar</a>
</li>
<li>
  <a href="https://longlifefamilystudy.wustl.edu" class="external-link"></a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>creating-a-release</h1>
            
      
      
      <div class="hidden name"><code>creating-a-release.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="creating-a-release">Creating a Release<a class="anchor" aria-label="anchor" href="#creating-a-release"></a>
</h2>
<p>This should come after the previous QC steps (batch effects, sex and
expression). The metadata in the <code>dds</code> objects should be
updated now with the current state of the database, meaning any
additional suspicious sex samples or WGS identified mislabels, for
instance, have been flagged in the database itself, and that updated
information added back to the <code>dds</code> object.</p>
<div class="section level3">
<h3 id="first-read-in-the-data-you-wish-to-process-gene-or-tx">First, read in the data you wish to process (gene or tx)<a class="anchor" aria-label="anchor" href="#first-read-in-the-data-you-wish-to-process-gene-or-tx"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikelove/DESeq2" class="external-link">DESeq2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioinf.wehi.edu.au/edgeR/" class="external-link">edgeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set environmental variables</span></span>
<span><span class="co">## set to false to use gene level quantification, true to use</span></span>
<span><span class="co">## tx level quantification</span></span>
<span><span class="va">TX_QUANTS</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="co">## determines whether data is written to the project data directory</span></span>
<span><span class="va">WRITE</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span></span>
<span><span class="co"># read in data ----------------------------------------------------------------</span></span>
<span><span class="va">dds_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  gene <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"llfs_rnaseq_data/dds_20230713_gene.rds"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  tx   <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"llfs_rnaseq_data/dds_20230713_tx.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note, clear out any design -- it isn't necessary for the manipulations below.</span></span>
<span><span class="co"># if you want to set the design, then change the formula below. Make sure to</span></span>
<span><span class="co"># cast any character fields to factors.</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">TX_QUANTS</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">dds_full</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">dds_list</span><span class="op">$</span><span class="va">tx</span><span class="op">)</span></span>
<span>  <span class="fu">design</span><span class="op">(</span><span class="va">dds_full</span><span class="op">)</span> <span class="op">=</span> <span class="op">~</span><span class="fl">1</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">dds_full</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">dds_list</span><span class="op">$</span><span class="va">gene</span><span class="op">)</span></span>
<span>  <span class="fu">design</span><span class="op">(</span><span class="va">dds_full</span><span class="op">)</span> <span class="op">=</span> <span class="op">~</span><span class="fl">1</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="next-split-the-dds-object-into-control-and-experiment-sets">Next, split the dds object into <code>control</code> and
<code>experiment</code> sets<a class="anchor" aria-label="anchor" href="#next-split-the-dds-object-into-control-and-experiment-sets"></a>
</h3>
<p>These are as they sound – the ‘pool’ and ‘phantom’ control samples
are separated from the experimental samples. The control set is not
exported from the <code>dds</code> object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add the `purpose` field -- note that this is temporary and will be added </span></span>
<span><span class="co"># to the llfs_rnaseq_metadata view</span></span>
<span><span class="va">dds_full</span><span class="op">$</span><span class="va">purpose</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dds_full</span><span class="op">$</span><span class="va">visit</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> </span>
<span>           <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dds_full</span><span class="op">$</span><span class="va">relabel_reason</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>              <span class="va">dds_full</span><span class="op">$</span><span class="va">relabel_reason</span> <span class="op">==</span> <span class="st">'phantom'</span><span class="op">)</span>,</span>
<span>         <span class="st">'control'</span>,</span>
<span>         <span class="st">'experiment'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># some checks on the metadata -------------------------------------------------</span></span>
<span><span class="co">## ensure that there are no mislabel TRUE that have been relabelled already</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">dds_full</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">dds_full</span><span class="op">$</span><span class="va">relabel_reason</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>                          <span class="va">dds_full</span><span class="op">$</span><span class="va">mislabel</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dds_full</span><span class="op">$</span><span class="va">legal</span><span class="op">)</span> <span class="op">==</span> <span class="st">'yes'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># split into control and experimental sets ------------------------------------</span></span>
<span><span class="va">dds_control</span> <span class="op">=</span> <span class="va">dds_full</span><span class="op">[</span>,<span class="va">dds_full</span><span class="op">$</span><span class="va">purpose</span> <span class="op">==</span> <span class="st">'control'</span><span class="op">]</span></span>
<span><span class="va">dds_experiment</span> <span class="op">=</span> <span class="va">dds_full</span><span class="op">[</span>,<span class="va">dds_full</span><span class="op">$</span><span class="va">purpose</span> <span class="op">==</span> <span class="st">'experiment'</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-gene-wise-expression-filter">Create a gene-wise (expression) filter<a class="anchor" aria-label="anchor" href="#create-a-gene-wise-expression-filter"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filtering -------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">## Expression Filter ----</span></span>
<span></span>
<span><span class="co"># at the time of writing, num_samples comes out to 19</span></span>
<span><span class="va">num_samples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">dds_experiment</span><span class="op">)</span><span class="op">*</span><span class="fl">.015</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter out low expression genes</span></span>
<span><span class="va">mid_expression_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html" class="external-link">cpm</a></span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">dds_experiment</span><span class="op">)</span><span class="op">)</span>  <span class="op">&gt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">num_samples</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-sample-wise-filter">Create a sample-wise filter<a class="anchor" aria-label="anchor" href="#create-a-sample-wise-filter"></a>
</h3>
<p>We wish to filter out both (subject, visit) duplicates – this can
arise due to either on-purpose re-dos of “bad” samples, or due to
accidental mislabels which create duplicate samples – and those samples
which fail QC.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Deduplicate</span></span>
<span><span class="co">## duplications can occur due to sample re-dos, or due to relabelling</span></span>
<span><span class="co">## mislabelled samples</span></span>
<span><span class="va">dedup_sample_ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">dds_experiment</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">visit</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">percent_intergenic</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">percent_intergenic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Quality Filter ----</span></span>
<span></span>
<span><span class="co"># passing samples have less than 8% intergenic reads, do not express</span></span>
<span><span class="co"># the wrong sex chromosome according to their sample label, and are not</span></span>
<span><span class="co"># identified as mislabels from the RNA variant vs WGS DNA variant comparison.</span></span>
<span><span class="co"># Note that a sample labelled "mislabelled" is one whose variants clearly </span></span>
<span><span class="co"># mismatched the WGS sample of the same subject identifier, but for which </span></span>
<span><span class="co"># there was no obvious match also found in the WGS subject set</span></span>
<span><span class="va">passing_qc_sample_ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">dds_experiment</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># note the negation at the beginning of the conditional -- I find it easier</span></span>
<span>  <span class="co"># to think about samples which are failing rather than the other way around</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">mislabelled</span>, <span class="op">!</span><span class="va">suspicious_sex</span>, <span class="va">percent_intergenic</span> <span class="op">&lt;</span> <span class="fl">0.08</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">analysis_sample_ids</span> <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">dedup_filter</span>, <span class="va">qc_filter</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="apply-the-filters-and-export-plain-text-data">Apply the filters and export plain text data<a class="anchor" aria-label="anchor" href="#apply-the-filters-and-export-plain-text-data"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Apply Filters ----</span></span>
<span></span>
<span><span class="co"># filter the deseq data object on the rows (genes) and samples (column)</span></span>
<span><span class="va">dds_experiment_passing</span> <span class="op">=</span> </span>
<span>  <span class="va">dds_experiment</span><span class="op">[</span><span class="va">mid_expression_filter</span>, </span>
<span>                 <span class="va">dds_experiment</span><span class="op">$</span><span class="va">sample_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">analysis_sample_ids</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># add size factors to the dds object</span></span>
<span><span class="va">dds_experiment_passing</span> <span class="op">=</span> <span class="fu">estimateSizeFactors</span><span class="op">(</span><span class="va">dds_experiment_passing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract data from dds object ------------------------------------------------</span></span>
<span></span>
<span><span class="va">output_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  raw_unfltr_counts <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">dds_full</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  unfltr_feature_id <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>gene_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dds_full</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  raw_fltr_counts <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">dds_experiment_passing</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  norm_fltr_counts <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu">counts</span><span class="op">(</span><span class="va">dds_experiment_passing</span>, normalized<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  fltr_feature_id <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>gene_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dds_experiment_passing</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write out -------------------------------------------------------------------</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">WRITE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">today</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">TX_QUANTS</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">add_sep</span> <span class="op">=</span> <span class="st">"_tx_"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">add_sep</span> <span class="op">=</span> <span class="st">"_gene_"</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">sample_metadata_path</span> <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"llfs_rnaseq_data/plain_text"</span>, </span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sample_meta_"</span>, </span>
<span>                                     <span class="va">today</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Do not overwrite -- if this is already been run, ie if you run the gene</span></span>
<span>  <span class="co"># data and then the tx data, there is no reason to re-write the sample</span></span>
<span>  <span class="co"># metadata. Pay attention to this if you do want to re-write on the same</span></span>
<span>  <span class="co"># day</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">sample_metadata_path</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">dds_full</span><span class="op">)</span><span class="op">)</span>, <span class="va">sample_metadata_path</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">output_list</span><span class="op">)</span>,</span>
<span>      <span class="op">~</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">output_list</span><span class="op">[[</span><span class="va">.</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"llfs_rnaseq_data/plain_text"</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">add_sep</span>, <span class="va">today</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Chase Mateusiak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
